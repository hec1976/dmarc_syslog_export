<dashboard>
  <label>DMARC Übersicht</label>
  <description>Visualisierung von DMARC-Aggregatberichten</description>
  <row>
    <panel>
      <title>Timeline: E-Mails nach Disposition</title>
      <chart>
        <search>
          <query>index=dmarc sourcetype=dmarc:report
| timechart span=1h sum(count) by disposition</query>
        </search>
        <option name="charting.chart">line</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Top Absender-IPs (GeoIP möglich)</title>
      <chart>
        <search>
          <query>index=dmarc sourcetype=dmarc:report
| top ip limit=10</query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>

    <panel>
      <title>Verteilung: DKIM-Ergebnis</title>
      <chart>
        <search>
          <query>index=dmarc sourcetype=dmarc:report
| stats sum(count) as Count by dkim</query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>

    <panel>
      <title>Verteilung: SPF-Ergebnis</title>
      <chart>
        <search>
          <query>index=dmarc sourcetype=dmarc:report
| stats sum(count) as Count by spf</query>
        </search>
        <option name="charting.chart">pie</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Verteilung nach Ziel-Domain</title>
      <chart>
        <search>
          <query>index=dmarc sourcetype=dmarc:report
| stats sum(count) as Count by domain
| sort - Count
| head 10</query>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>

    <panel>
      <title>Disposition nach Land (GeoIP)</title>
      <chart>
        <search>
          <query>index=dmarc sourcetype=dmarc:report
| iplocation ip
| stats sum(count) as Count by Country disposition
| sort - Count</query>
        </search>
        <option name="charting.chart">column</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Detailtabelle (letzte 100)</title>
      <table>
        <search>
          <query>index=dmarc sourcetype=dmarc:report
| table _time ip domain disposition dkim spf count header_from dkim_domain dkim_result spf_domain spf_result
| sort -_time
| head 100</query>
        </search>
      </table>
    </panel>
  </row>
</dashboard>
